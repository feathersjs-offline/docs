<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrating | FeathersJS Offline-first Guide</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="An offline-first capability with automatic synchronization added to the impressive Feathers stack for modern applications">
    
    <link rel="preload" href="/docs/assets/css/0.styles.53d6aabb.css" as="style"><link rel="preload" href="/docs/assets/js/app.1094d4a3.js" as="script"><link rel="preload" href="/docs/assets/js/4.c53728fa.js" as="script"><link rel="preload" href="/docs/assets/js/61.b4772d7e.js" as="script"><link rel="prefetch" href="/docs/assets/js/1.ff018d79.js"><link rel="prefetch" href="/docs/assets/js/10.6d2b84cc.js"><link rel="prefetch" href="/docs/assets/js/11.4fc7a11e.js"><link rel="prefetch" href="/docs/assets/js/12.fb7e355a.js"><link rel="prefetch" href="/docs/assets/js/13.577b9f16.js"><link rel="prefetch" href="/docs/assets/js/14.0db19a56.js"><link rel="prefetch" href="/docs/assets/js/15.2abefca6.js"><link rel="prefetch" href="/docs/assets/js/16.0f9b97e6.js"><link rel="prefetch" href="/docs/assets/js/17.c8ee3014.js"><link rel="prefetch" href="/docs/assets/js/18.3dfbb01a.js"><link rel="prefetch" href="/docs/assets/js/19.54004e9f.js"><link rel="prefetch" href="/docs/assets/js/20.bc5638aa.js"><link rel="prefetch" href="/docs/assets/js/21.e40e99d5.js"><link rel="prefetch" href="/docs/assets/js/22.48a2ec70.js"><link rel="prefetch" href="/docs/assets/js/23.44e45085.js"><link rel="prefetch" href="/docs/assets/js/24.a4eb5e39.js"><link rel="prefetch" href="/docs/assets/js/25.c78fe469.js"><link rel="prefetch" href="/docs/assets/js/26.c53d7978.js"><link rel="prefetch" href="/docs/assets/js/27.91d3ef7b.js"><link rel="prefetch" href="/docs/assets/js/28.e552ab43.js"><link rel="prefetch" href="/docs/assets/js/29.e31ae83e.js"><link rel="prefetch" href="/docs/assets/js/30.ec91fd99.js"><link rel="prefetch" href="/docs/assets/js/31.8ebfb40a.js"><link rel="prefetch" href="/docs/assets/js/32.1ac343dd.js"><link rel="prefetch" href="/docs/assets/js/33.99a27451.js"><link rel="prefetch" href="/docs/assets/js/34.8323eafe.js"><link rel="prefetch" href="/docs/assets/js/35.0f598544.js"><link rel="prefetch" href="/docs/assets/js/36.594c76a1.js"><link rel="prefetch" href="/docs/assets/js/37.e598e0f4.js"><link rel="prefetch" href="/docs/assets/js/38.937f1526.js"><link rel="prefetch" href="/docs/assets/js/39.25c6216a.js"><link rel="prefetch" href="/docs/assets/js/40.03450d3a.js"><link rel="prefetch" href="/docs/assets/js/41.d08f5a16.js"><link rel="prefetch" href="/docs/assets/js/42.e708aa2a.js"><link rel="prefetch" href="/docs/assets/js/43.75c99ac3.js"><link rel="prefetch" href="/docs/assets/js/44.cab55e19.js"><link rel="prefetch" href="/docs/assets/js/45.a2c82e38.js"><link rel="prefetch" href="/docs/assets/js/46.6fec4c23.js"><link rel="prefetch" href="/docs/assets/js/47.269c781a.js"><link rel="prefetch" href="/docs/assets/js/48.a9aea57f.js"><link rel="prefetch" href="/docs/assets/js/49.70a8a84b.js"><link rel="prefetch" href="/docs/assets/js/5.a4fd78c2.js"><link rel="prefetch" href="/docs/assets/js/50.0ff09f72.js"><link rel="prefetch" href="/docs/assets/js/51.cef27d87.js"><link rel="prefetch" href="/docs/assets/js/52.f85281bc.js"><link rel="prefetch" href="/docs/assets/js/53.53e02ab6.js"><link rel="prefetch" href="/docs/assets/js/54.a285fbb1.js"><link rel="prefetch" href="/docs/assets/js/55.778d628e.js"><link rel="prefetch" href="/docs/assets/js/56.03bb500b.js"><link rel="prefetch" href="/docs/assets/js/57.25000ce2.js"><link rel="prefetch" href="/docs/assets/js/58.f841535c.js"><link rel="prefetch" href="/docs/assets/js/59.975ebd41.js"><link rel="prefetch" href="/docs/assets/js/6.f0db8c3b.js"><link rel="prefetch" href="/docs/assets/js/60.94ce4443.js"><link rel="prefetch" href="/docs/assets/js/62.4cc86ddf.js"><link rel="prefetch" href="/docs/assets/js/63.91d503c8.js"><link rel="prefetch" href="/docs/assets/js/64.1aca66d4.js"><link rel="prefetch" href="/docs/assets/js/65.31d64d2c.js"><link rel="prefetch" href="/docs/assets/js/7.cdaa092c.js"><link rel="prefetch" href="/docs/assets/js/8.7d3a78be.js"><link rel="prefetch" href="/docs/assets/js/9.c0ccb070.js"><link rel="prefetch" href="/docs/assets/js/vendors~docsearch.1fd57456.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.53d6aabb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/img/img/feathers-offline-first.png" alt="FeathersJS Offline-first Guide" class="logo"></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/guides/" class="nav-link router-link-active">Guides</a></div><div class="nav-item"><a href="/docs/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/docs/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://docs.feathersjs.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathersjs (v4 Crow, current)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs-offline/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <a href="#" style="margin-left:20px"><span class="tooltip"><span alt-text="Toggle dark mode"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lightbulb" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" class="svg-inline--fa fa-lightbulb fa-w-11"><path fill="currentColor" d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></span><span class="tooltiptext">Toggle dark mode</span></span></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/guides/" class="nav-link router-link-active">Guides</a></div><div class="nav-item"><a href="/docs/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/docs/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://docs.feathersjs.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathersjs (v4 Crow, current)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs-offline/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>The Offline-first guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/guides/basics/setup.html" class="sidebar-link">Getting ready</a></li><li><a href="/docs/guides/basics/starting.html" class="sidebar-link">Quick start</a></li><li><a href="/docs/guides/basics/generator.html" class="sidebar-link">Generating an app</a></li><li><a href="/docs/guides/basics/services.html" class="sidebar-link">Services</a></li><li><a href="/docs/guides/basics/hooks.html" class="sidebar-link">Hooks</a></li><li><a href="/docs/guides/basics/authentication.html" class="sidebar-link">Authentication</a></li><li><a href="/docs/guides/basics/frontend.html" class="sidebar-link">Building a frontend</a></li><li><a href="/docs/guides/basics/offline-first.html" class="sidebar-link">Offline-first</a></li><li><a href="/docs/guides/basics/implementation.html" class="sidebar-link">How is own-data/own-net implemented?</a></li><li><a href="/docs/guides/basics/testing.html" class="sidebar-link">Writing tests</a></li></ul></section></li><li><a href="/docs/guides/frameworks.html" class="sidebar-link">Frontend Frameworks</a></li><li><a href="/docs/guides/security.html" class="sidebar-link">Security</a></li><li><a href="/docs/guides/migrating.html" aria-current="page" class="active sidebar-link">Migrating</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#versioning" class="sidebar-link">Versioning</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#auto-upgrade" class="sidebar-link">Auto upgrade</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#authentication" class="sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#manual-upgrade" class="sidebar-link">Manual upgrade</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#authentication-client" class="sidebar-link">Authentication client</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#upgrade-notes" class="sidebar-link">Upgrade Notes</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#feathers-core" class="sidebar-link">Feathers core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#typescript-definitions-included" class="sidebar-link">Typescript definitions included</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#services-at-the-root-level" class="sidebar-link">Services at the root level</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#skip-event-emitting" class="sidebar-link">Skip event emitting</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#disconnect-event" class="sidebar-link">disconnect event</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#deprecated-context-next-and-skip-functionality" class="sidebar-link">Deprecated (context, next) and SKIP functionality</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#feathersjs-express" class="sidebar-link">@feathersjs/express</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#database-adapters" class="sidebar-link">Database adapters</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#querying-by-id" class="sidebar-link">Querying by id</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#hook-less-service-methods" class="sidebar-link">Hook-less service methods</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#multi-updates" class="sidebar-link">Multi updates</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#whitelisting" class="sidebar-link">Whitelisting</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#backwards-compatibility" class="sidebar-link">Backwards compatibility</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#old-client-jwt-compatibility" class="sidebar-link">Old client JWT compatibility</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#oauth-cookies" class="sidebar-link">OAuth cookies</a></li><li class="sidebar-sub-header"><a href="/docs/guides/migrating.html#passportjs" class="sidebar-link">PassportJS</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="migrating"><a href="#migrating" class="header-anchor">#</a> Migrating</h1> <p>This guide explains the new features and changes to migrate to the Feathers v4 (Crow) release. It expects applications to be using the previous Feathers v3 (Buzzard).</p> <h2 id="versioning"><a href="#versioning" class="header-anchor">#</a> Versioning</h2> <p>Instead of separate versioning, all modules in the <code>@feathersjs</code> namespace have been updated to use the same version number. This means that the current release (Crow) will be <strong>Feathers v4</strong> and using this release means all <code>@feathersjs/</code> module dependencies show a version of <code>4.x.x</code> (<code>4.0.0-pre.x</code> for prereleases). For historical reasons the first official version will be <code>4.3.0</code>.</p> <p>The <a href="/docs/api/databases/adapters.html">database adapters</a> will continue to be individually versioned, since they can be used with most Feathers versions from v2 and up.</p> <h2 id="auto-upgrade"><a href="#auto-upgrade" class="header-anchor">#</a> Auto upgrade</h2> <p>The <code>@feathersjs/cli</code> comes with a command to automatically upgrade applications generated through <code>@feathersjs/cli</code> (v3.x) with most of the changes necessary for v4. To update the CLI and upgrade your application run:</p> <div class="language- extra-class"><pre class="language-text"><code>npm i @feathersjs/cli -g
cd myapp
feathers upgrade
</code></pre></div><p>This will update the dependencies in <code>package.json</code>, update the <code>src/authentication.js</code> and <code>config/default.json</code> with the new authentication setup. The old contents will be kept in <code>src/authentication.backup.js</code> and <code>config/default.backup.json</code> but can be removed once upgrade is completed.</p> <p><strong>Manual steps are necessary for</strong></p> <ul><li>The <code>hashPassword()</code> hook in <code>service/users/users.hooks.js</code> which now requires the password field name (usually <code>hashPassword('password')</code>)</li> <li>Configuring OAuth providers - see <a href="/docs/api/authentication/oauth.html">OAuth API</a></li> <li>The authentication Express middleware has been moved to <code>const { authenticate } = require('@feathersjs/express');</code></li> <li>Any other authentication specific customization - see <a href="/docs/api/authentication/service.html">authentication service API</a></li> <li>Feathers client authentication - see <a href="/docs/api/authentication/client.html">authentication client API</a></li></ul> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <p>The <code>@feathersjs/authentication-*</code> modules have been completely rewritten to include more secure defaults, be easier to customize, framework independent and no longer rely on PassportJS. It comes with:</p> <ul><li>An extensible <a href="/docs/api/authentication/service.html">authentication service</a> that can register strategies and create authentication tokens (JWT by default but pluggable for anything else)</li> <li>Protocol independent, fully customizable authentication strategies</li> <li>Better <a href="/docs/api/authentication/oauth.html">OAuth authentication</a> with 180+ providers supported out of the box without any additional configuration (other than adding the application key and secret)</li> <li>Built-in OAuth account linking and cross-domain OAuth redirects</li></ul> <h3 id="manual-upgrade"><a href="#manual-upgrade" class="header-anchor">#</a> Manual upgrade</h3> <p>To upgrade manually, replace the existing authentication configuration (usually <code>src/authentication.js</code> or <code>src/authentication.ts</code>) with the following:</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="javascript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> AuthenticationService<span class="token punctuation">,</span> JWTStrategy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> LocalStrategy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication-local'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> expressOauth <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication-oauth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationService</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JWTStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/authentication'</span><span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">expressOauth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="typescript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Application <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@feathersjs/feathers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthenticationService<span class="token punctuation">,</span> JWTStrategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@feathersjs/authentication'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LocalStrategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@feathersjs/authentication-local'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> expressOauth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@feathersjs/authentication-oauth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>app<span class="token operator">:</span> Application<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationService</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JWTStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/authentication'</span><span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">expressOauth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <blockquote><p><strong>Important:</strong> The <code>@feathersjs/authentication-jwt</code> is deprecated since the JWT strategy is now directly included in <code>@feathersjs/authentication</code>.</p></blockquote> <p>This will register <code>local</code>, <code>jwt</code> and OAuth authentication strategies using the standard authentication service on the <code>/authentication</code> path. OAuth will only be active if provider information is added to the configuration. The authentication configuration (usually in <code>config/default.json</code>) should be updated as follows:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;authentication&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;secret&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;your secret&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;authStrategies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;jwt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;local&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jwtOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;header&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;access&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;audience&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://yourdomain.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;issuer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;feathers&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;algorithm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;expiresIn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1d&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;local&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;usernameField&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;passwordField&quot;</span><span class="token operator">:</span> <span class="token string">&quot;password&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="authentication-client"><a href="#authentication-client" class="header-anchor">#</a> Authentication client</h3> <p>The v4 authentication client comes with many usability improvements and more reliable socket (re)connection. Since the server side authentication now includes all necessary information, it is no longer necessary to encode the token and get the user separately.</p> <p>Instead of</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> feathersClient <span class="token operator">=</span> <span class="token function">feathers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

feathersClient<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3030'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superagent</span><span class="token punctuation">(</span>superagent<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">{</span> storage<span class="token operator">:</span> localStorage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

feathersClient<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  strategy<span class="token operator">:</span> <span class="token string">'local'</span><span class="token punctuation">,</span>
  email<span class="token operator">:</span> <span class="token string">'admin@feathersjs.com'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'admin'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Authenticated!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> feathersClient<span class="token punctuation">.</span>passport<span class="token punctuation">.</span><span class="token function">verifyJWT</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JWT Payload'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> feathersClient<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  feathersClient<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> feathersClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error authenticating!'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Can now be done as</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> feathersClient <span class="token operator">=</span> <span class="token function">feathers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

feathersClient<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3030'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superagent</span><span class="token punctuation">(</span>superagent<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">{</span> storage<span class="token operator">:</span> localStorage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> feathersClient<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      strategy<span class="token operator">:</span> <span class="token string">'local'</span><span class="token punctuation">,</span>
      email<span class="token operator">:</span> <span class="token string">'admin@feathersjs.com'</span><span class="token punctuation">,</span>
      password<span class="token operator">:</span> <span class="token string">'admin'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User authenticated'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Authentication information is'</span><span class="token punctuation">,</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'authentication'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Authentication failed</span>
    <span class="token comment">// E.g. show login form</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>The <code>feathersClient.authenticate()</code> with no parameters to authenticate with an existing token is still avaiable but should be replaced by the more clear <code>feathersClient.reAuthenticate()</code>.</p> <p>To access the current authentication information, the <code>app.get('authentication')</code> promise can be used:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// user is the authenticated user</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'authentication'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// As a promise instead of async/await</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'authentication'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">authInfo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> authInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="upgrade-notes"><a href="#upgrade-notes" class="header-anchor">#</a> Upgrade Notes</h3> <p>Important things to note:</p> <ul><li>Because of extensive changes and security improvements, you should change your JWT secret so that all users will be prompted to log in again.</li> <li>The <code>jwt</code> options have been moved to <code>jwtOptions</code>. It takes all <a href="https://github.com/auth0/node-jsonwebtoken#jwtsignpayload-secretorprivatekey-options-callback" target="_blank" rel="noopener noreferrer">jsonwebtoken options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The <code>subject</code> option <strong>should be removed</strong> when using the standard setup.</li> <li><code>authStrategies</code> are the strategies that are allowed on the <code>/authentication</code> endpoint</li> <li>The <code>hashPassword</code> hook now explicitly requires the name of the field to hash instead of using a default (change any <code>hashPassword()</code> to e.g. <code>hashPassword('password')</code>).</li> <li>For websockets, the <code>authenticate</code> event is no longer available. See <a href="/docs/api/client/socketio.html#authentication">Socket.io Authentication direct usage</a> for more information.</li></ul> <h2 id="feathers-core"><a href="#feathers-core" class="header-anchor">#</a> Feathers core</h2> <p>The following new features and deprecations are included in Feathers v4 core.</p> <h3 id="typescript-definitions-included"><a href="#typescript-definitions-included" class="header-anchor">#</a> Typescript definitions included</h3> <p>All <code>@feathersjs</code> modules now come with up-to-date TypeScript definitions. Any definitions using <code>@types/feathersjs__*</code> <em>should be removed</em> from your project.</p> <h3 id="services-at-the-root-level"><a href="#services-at-the-root-level" class="header-anchor">#</a> Services at the root level</h3> <p>Any Feathers application now allows to register a service at the root level with a name of <code>/</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> myService<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It will be available via <code>app.service('/')</code> through the client and directly at <code>http://feathers-server.com/</code> via REST.</p> <h3 id="skip-event-emitting"><a href="#skip-event-emitting" class="header-anchor">#</a> Skip event emitting</h3> <p>Service events can now be skipped by setting <code>context.event</code> to <code>null</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Skip sending event</span>
  context<span class="token punctuation">.</span>event <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="disconnect-event"><a href="#disconnect-event" class="header-anchor">#</a> <code>disconnect</code> event</h3> <p>There is now an application level <code>disconnect</code> event when a connection gets disconnect:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something on disconnect here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> Disconnected connections will be removed from all channels already automatically.</p></blockquote> <h3 id="deprecated-context-next-and-skip-functionality"><a href="#deprecated-context-next-and-skip-functionality" class="header-anchor">#</a> Deprecated <code>(context, next)</code> and SKIP functionality</h3> <p>In preparation to support Koa style hooks (see <a href="https://github.com/feathersjs/feathers/issues/932" target="_blank" rel="noopener noreferrer">feathersjs/feathers#932<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) returning <code>SKIP</code> and calling the deprecated <code>next</code> function in hooks has been removed. Returning <code>SKIP</code> in hooks was causing issues because</p> <ul><li>It is not easily possible to see if a hook makes its following hooks skip. This made hook chains very hard to debug.</li> <li>Returning SKIP also causes problems with Feathers internals like the event system</li></ul> <p>The use-cases for <code>feathers.SKIP</code> can now be explicitly handled by</p> <ul><li><a href="https://hooks-common.feathersjs.com/hooks.html#iff" target="_blank" rel="noopener noreferrer">Running hooks conditionally<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> through a flag</li> <li><a href="#hook-less-service-methods">Calling the hook-less service methods</a> of the database adapters</li> <li>Setting <code>context.event = null</code> to skip event emitting</li></ul> <h3 id="feathersjs-express"><a href="#feathersjs-express" class="header-anchor">#</a> <code>@feathersjs/express</code></h3> <ul><li><code>@feathersjs/express/errors</code> has been moved to <code>const { errorHandler } = require('@feathersjs/express');</code>. It is no longer available via <code>@feathersjs/errors</code>.</li> <li><code>@feathersjs/express/not-found</code> has been moved to <code>const { notFound } = require('@feathersjs/express');</code>.</li></ul> <h2 id="database-adapters"><a href="#database-adapters" class="header-anchor">#</a> Database adapters</h2> <p>The latest versions of the Feathers database adapters include some important security and usability updates by requiring to explicitly enable certain functionality that was previously available by default.</p> <blockquote><p><strong>Important:</strong> The latest versions of the database adapters also work with previous versions of Feathers. An upgrade of the <code>@feathersjs/</code> modules is recommended but not necessary to use the latest database adapter features.</p></blockquote> <h3 id="querying-by-id"><a href="#querying-by-id" class="header-anchor">#</a> Querying by id</h3> <p>All database adapters now support additional query parameters for <code>get</code>, <code>remove</code>, <code>update</code> and <code>patch</code>. If the record does not match that query, even if the <code>id</code> is valid, a <code>NotFound</code> error will be thrown. This is very useful for the common case of e.g. restricting requests to the users company the same way as you already would in a <code>find</code> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Will throw `NotFound` if `companyId` does not match</span>
<span class="token comment">// Even if the `id` is available</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'/messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'&lt;message id&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span> companyId<span class="token operator">:</span> <span class="token string">'&lt;my company&gt;'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hook-less-service-methods"><a href="#hook-less-service-methods" class="header-anchor">#</a> Hook-less service methods</h3> <p>The database adapters now support calling their service methods without any hooks by adding a <code>_</code> in front of the method name as <code>_find</code>, <code>_get</code>, <code>_create</code>, <code>_patch</code>, <code>_update</code> and <code>_remove</code>. This can be useful if you need the raw data from the service and don't want to trigger any of its hooks.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Call `get` without running any hooks</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'/messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_get</span><span class="token punctuation">(</span><span class="token string">'&lt;message id&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em>Note:</em> These methods are only available internally on the server, not on the client side and only for the Feathers database adapters. They do <em>not</em> send any events.</p></blockquote> <h3 id="multi-updates"><a href="#multi-updates" class="header-anchor">#</a> Multi updates</h3> <p>Creating, updating or removing multiple records at once has always been part of the Feathers adapter specification but it turned out to be quite easy to miss.</p> <p>This means applications could be open to queries that a developer did not anticipate (like deleting or creating multiple records at once). Additionally, it could also lead to unexpected data in a hook that require special cases (like <code>context.data</code> or <code>context.result</code> being an array).</p> <p>Now, multiple <code>create</code>, <code>patch</code> and <code>remove</code> calls (with the <code>id</code> value set to <code>null</code>) are disabled by default and have to be enabled explicitly by setting the <code>multi</code> option:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'feathers-&lt;database&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow multi create, patch and remove</span>
<span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  multi<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only allow create with an array</span>
<span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  multi<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'create'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only allow multi patch and remove (with `id` set to `null`)</span>
<span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  multi<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'patch'</span><span class="token punctuation">,</span> <span class="token string">'remove'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em>Important:</em> When enabling multiple remove and patch requests, make sure to restrict the allowed query (e.g. based on the authenticated user id), otherwise it could be possible to delete or patch every record in the database.</p></blockquote> <h3 id="whitelisting"><a href="#whitelisting" class="header-anchor">#</a> Whitelisting</h3> <p>Some database adapters allowed additional query parameters outside of the official Feathers query syntax. To reduce the risk of allowing malicious queries, only the standard query syntax is now allowed.</p> <p>Non-standard query parameters (any query property starting with a <code>$</code>) will now throw an error. To allow them, they have to be explicitly whitelisted using the <code>whitelist</code> option:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'feathers-&lt;database&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow to use $regex in query parameters</span>
<span class="token function">service</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  whitelist<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'$regex'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><em>Important:</em> Be aware of potential security implications of manually whitelisted options. E.g. Enabling Mongoose <code>$populate</code> can expose fields that are normally protected at the service level (e.g. a users password) and have to be removed separately.</p></blockquote> <h2 id="backwards-compatibility"><a href="#backwards-compatibility" class="header-anchor">#</a> Backwards compatibility</h2> <p>The REST authentication flow is still the same and the previous socket authentication mechanism is also still supported. New websocket authentication works the same as authentication via REST.</p> <p>For security reasons, the authentication secret should be changed so that all current JWTs will become invalid and prompt the users to log in again and issue new valid access tokens. The authentication Feathers clients should be updated since it includes many bug fixes on reconnection issues and usability improvements.</p> <h3 id="old-client-jwt-compatibility"><a href="#old-client-jwt-compatibility" class="header-anchor">#</a> Old client JWT compatibility</h3> <p>Although upgrading the clients and issuing new tokens is highly recommended, the following setup can be used to provide backwards compatible authentication:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> AuthenticationService<span class="token punctuation">,</span> JWTStrategy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> LocalStrategy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication-local'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> expressOauth <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/authentication-oauth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyAuthenticationService</span> <span class="token keyword">extends</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token parameter">authResult<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Call original `getPayload` first</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span>authResult<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> authResult<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>payload<span class="token punctuation">,</span>
      userId<span class="token operator">:</span> user<span class="token punctuation">.</span>id
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LegacyJWTStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">JWTStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">getEntityId</span><span class="token punctuation">(</span><span class="token parameter">authResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> authentication<span class="token operator">:</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> authResult<span class="token punctuation">;</span>

    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>userId <span class="token operator">||</span> payload<span class="token punctuation">.</span>sub<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyAuthenticationService</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LegacyJWTStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  authentication<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/authentication'</span><span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">expressOauth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="oauth-cookies"><a href="#oauth-cookies" class="header-anchor">#</a> OAuth cookies</h3> <p>To support OAuth for the old authentication client that was using a cookie instead of the redirect to transmit the access token the following middleware can be used:</p> <blockquote><p><strong>Note:</strong> This is only necessary if the Feathers authentication client is not updated at the same time and if OAuth is being used.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> authService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationService</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

authService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JWTStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'github'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">GitHubStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/authentication'</span><span class="token punctuation">,</span> authService<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/oauth/cookie'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> access_token <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>access_token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'feathers-jwt'</span><span class="token punctuation">,</span> access_token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      httpOnly<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token comment">// other cookie options here</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/redirect-url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token function">expressOauth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Also update <code>config/default.json</code> <code>redirect</code> with <code>/oauth/cookie?</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;authentication&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;oauth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;redirect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/oauth/cookie?&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="passportjs"><a href="#passportjs" class="header-anchor">#</a> PassportJS</h3> <p>PassportJS is the quasi-standard authentication mechanism for Express applications. Unfortunately it doesn't play very well with other frameworks (which Feathers can easily support otherwise) or real time connections. PassportJS can still be used through its direct Express middleware usage and then passing the authentication information <a href="/docs/api/express.html#params">as service <code>params</code></a>.</p></div> <footer class="page-edit"><blockquote><p>
        Anything unclear or missing?
        <a href="/help" rel="noopener noreferrer">
          Get help
        </a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span> or <a href="https://github.com/docs/edit/crow/packages/docs/guides/migrating.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></p> <small><span class="prefix">Last Updated: </span> <span class="time">11/17/2020, 3:17:03 PM</span></small></blockquote></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/guides/security.html" class="prev">
          Security
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.1094d4a3.js" defer></script><script src="/docs/assets/js/4.c53728fa.js" defer></script><script src="/docs/assets/js/61.b4772d7e.js" defer></script>
  </body>
</html>
