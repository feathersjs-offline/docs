(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{413:function(t,a,e){"use strict";e.r(a);var s=e(43),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.npmjs.com/package/@feathersjs/authentication",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/npm/v/@feathersjs/authentication.svg?style=flat-square",alt:"npm version"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://github.com/feathersjs/feathers/blob/crow/packages/authentication/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/changelog-.md-blue.svg?style=flat-square",alt:"Changelog"}}),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("npm install @feathersjs/authentication --save\n")])])]),e("p",[t._v("The "),e("code",[t._v("AuthenticationService")]),t._v(" is a "),e("RouterLink",{attrs:{to:"/api/services.html"}},[t._v("Feathers service")]),t._v(" that allows to register different "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html"}},[t._v("authentication strategies")]),t._v(" and manage access tokens (using "),e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON web tokens (JWT)"),e("OutboundLink")],1),t._v(" by default). This section describes")],1),t._v(" "),e("ul",[e("li",[t._v("The "),e("a",{attrs:{href:"#setup"}},[t._v("standard setup")]),t._v(" used by the generator")]),t._v(" "),e("li",[t._v("How to "),e("a",{attrs:{href:"#configuration"}},[t._v("configure")]),t._v(" authentication and where the configuration should go")]),t._v(" "),e("li",[t._v("The different "),e("a",{attrs:{href:"#authentication-flows"}},[t._v("authentication flows")])]),t._v(" "),e("li",[t._v("The methods available on the authentication service")]),t._v(" "),e("li",[t._v("How to "),e("a",{attrs:{href:"#customization"}},[t._v("customize")]),t._v(" the authentication service")]),t._v(" "),e("li",[t._v("The "),e("a",{attrs:{href:"#events"}},[t._v("Events")]),t._v(" sent by the authentication service")])]),t._v(" "),e("h2",{attrs:{id:"setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[t._v("#")]),t._v(" Setup")]),t._v(" "),e("p",[t._v("The standard setup of "),e("a",{attrs:{href:""}},[t._v("the generator")]),t._v(" initializes an "),e("a",{attrs:{href:"#authenticationservice"}},[t._v("AuthenticationService")]),t._v(" at the "),e("code",[t._v("/authentication")]),t._v(" path with a "),e("RouterLink",{attrs:{to:"/api/authentication/jwt.html"}},[t._v("JWT strategy")]),t._v(", "),e("RouterLink",{attrs:{to:"/api/authentication/local.html"}},[t._v("Local strategy")]),t._v(" and "),e("RouterLink",{attrs:{to:"/api/authentication/oauth.html"}},[t._v("OAuth authentication")]),t._v(".")],1),t._v(" "),e("tabs",{attrs:{options:{useUrlFragment:!1}}},[e("tab",{attrs:{name:"JavaScript"}},[e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AuthenticationService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" JWTStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" LocalStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-local'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" expressOauth "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-oauth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" authService "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JWTStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'local'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("expressOauth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("tab",{attrs:{name:"TypeScript"}},[e("div",{staticClass:"language-typescript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-typescript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Application "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/feathers'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AuthenticationService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" JWTStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" LocalStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-local'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" expressOauth "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-oauth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Application"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" authService "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jwt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JWTStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'local'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("expressOauth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])],1),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("p",[t._v("The standard authentication service configuration is normally located in the "),e("code",[t._v("authentication")]),t._v(" section of a "),e("RouterLink",{attrs:{to:"/api/configuration.html"}},[t._v("configuration file")]),t._v(" (default: "),e("code",[t._v("config/default.json")]),t._v(").")],1),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Note:")]),t._v(" The authentication service can also be configured dynamically or without Feathers configuration by using "),e("RouterLink",{attrs:{to:"/api/application.html#set-name-value"}},[t._v("app.set")]),t._v(", e.g. "),e("code",[t._v("app.set('authentication', config)")]),t._v(".")],1)]),t._v(" "),e("p",[t._v("The following options are available:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("secret")]),t._v(": The JWT signing secret.")]),t._v(" "),e("li",[e("code",[t._v("service")]),t._v(": The path of the entity service")]),t._v(" "),e("li",[e("code",[t._v("authStrategies")]),t._v(": A list of authentication strategy names to allow on this authentication service to create access tokens.")]),t._v(" "),e("li",[e("code",[t._v("parseStrategies")]),t._v(": A list of authentication strategies that should be used to parse HTTP requests. Defaults to the same as "),e("code",[t._v("authStrategies")]),t._v(".")]),t._v(" "),e("li",[e("code",[t._v("entity")]),t._v(": The name of the field that will contain the entity after successful authentication. Will also be used to set "),e("code",[t._v("params[entity]")]),t._v(" (usually "),e("code",[t._v("params.user")]),t._v(") when using the "),e("a",{attrs:{href:"./hook"}},[t._v("authenticate hook")]),t._v(". Can be "),e("code",[t._v("null")]),t._v(" if no entity is used (see "),e("RouterLink",{attrs:{to:"/cookbook/authentication/stateless.html"}},[t._v("stateless tokens")]),t._v(").")],1),t._v(" "),e("li",[e("code",[t._v("entityId")]),t._v(": The id property of an entity object. Only necessary if the entity service does not have an "),e("code",[t._v("id")]),t._v(" property (e.g. when using a custom entity service).")]),t._v(" "),e("li",[e("code",[t._v("jwtOptions")]),t._v(": All options available for the "),e("a",{attrs:{href:"https://github.com/auth0/node-jsonwebtoken",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-jsonwebtoken package"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("p",[t._v("An authentication service configuration in "),e("code",[t._v("config/default.json")]),t._v(" can look like this:")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"authentication"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"secret"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CHANGE_ME"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"entity"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"service"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"authStrategies"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jwt"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"jwtOptions"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"header"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"typ"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"access"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"audience"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://yourdomain.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"issuer"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"feathers"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algorithm"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expiresIn"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1d"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[e("em",[t._v("Note:")]),t._v(" "),e("code",[t._v("typ")]),t._v(" in the "),e("code",[t._v("header")]),t._v(" options is not a typo, it is part of the "),e("a",{attrs:{href:"https://tools.ietf.org/html/rfc7519#section-5",target:"_blank",rel:"noopener noreferrer"}},[t._v("JWT JOSE header specification"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("p",[t._v("Additionally to the above configuration, most "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html"}},[t._v("strategies")]),t._v(" will look for their own configuration under the name it was registered. An example can be found in the "),e("RouterLink",{attrs:{to:"/api/authentication/local.html#configuration"}},[t._v("local strategy configuration")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"authentication-flows"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentication-flows"}},[t._v("#")]),t._v(" Authentication flows")]),t._v(" "),e("p",[t._v("The following")]),t._v(" "),e("h3",{attrs:{id:"to-create-a-new-jwt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#to-create-a-new-jwt"}},[t._v("#")]),t._v(" To "),e("em",[t._v("create a new JWT")])]),t._v(" "),e("p",[t._v("For any strategy allowed in "),e("code",[t._v("authStrategies")]),t._v(", a user can call "),e("code",[t._v("app.service('/authentication').create(data)")]),t._v(" or "),e("code",[t._v("POST /authentication")]),t._v(" with "),e("code",[t._v("data")]),t._v(" as "),e("code",[t._v("{ strategy: name, ...loginData }")]),t._v(". Internally authentication will then")]),t._v(" "),e("ul",[e("li",[t._v("Call the strategy "),e("code",[t._v(".authenticate")]),t._v(" method with "),e("code",[t._v("data")])]),t._v(" "),e("li",[t._v("Create a JWT for the entity returned by the strategy")]),t._v(" "),e("li",[t._v("Return the JWT ("),e("code",[t._v("accessToken")]),t._v(") and the additional information from the strategy")])]),t._v(" "),e("blockquote",[e("p",[t._v("For "),e("code",[t._v("local")]),t._v(" strategy, the user has to be created before doing auth, otherwise, a 401 "),e("code",[t._v("NotAuthenticated")]),t._v(" error will be send.")])]),t._v(" "),e("h3",{attrs:{id:"to-authenticate-an-external-request"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#to-authenticate-an-external-request"}},[t._v("#")]),t._v(" To "),e("em",[t._v("authenticate an external request")])]),t._v(" "),e("p",[t._v("For any HTTP request and strategy allowed in "),e("code",[t._v("parseStrategies")]),t._v(" or - if not set - "),e("code",[t._v("authStrategies")]),t._v(" authentication will:")]),t._v(" "),e("ul",[e("li",[t._v("Call "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html#parse-req-res"}},[t._v("strategy.parse")]),t._v(" and set the return value of the first strategy that does not return "),e("code",[t._v("null")]),t._v(" as "),e("code",[t._v("params.authentication")])],1),t._v(" "),e("li",[t._v("Verify "),e("code",[t._v("params.authentication")]),t._v(" using the "),e("RouterLink",{attrs:{to:"/api/authentication/hook.html"}},[t._v("authenticate hook")]),t._v(" which calls the strategy "),e("code",[t._v(".authenticate")]),t._v(" method with "),e("code",[t._v("params.authentication")]),t._v(" as the data")],1),t._v(" "),e("li",[t._v("Merge the return value of the strategy with "),e("code",[t._v("params")]),t._v(" (e.g. setting "),e("code",[t._v("params.user")]),t._v(")")])]),t._v(" "),e("h3",{attrs:{id:"to-authenticate-your-own-service-request"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#to-authenticate-your-own-service-request"}},[t._v("#")]),t._v(" To authenticate "),e("em",[t._v("your own service request")])]),t._v(" "),e("p",[t._v("For any service that uses the "),e("RouterLink",{attrs:{to:"/api/authentication/hook.html"}},[t._v("authenticate hook")]),t._v(" called internally you can set "),e("code",[t._v("params.authentication")]),t._v(" in the service call which will then:")],1),t._v(" "),e("ul",[e("li",[t._v("Verify "),e("code",[t._v("params.authentication")]),t._v(" using the "),e("RouterLink",{attrs:{to:"/api/authentication/hook.html"}},[t._v("authenticate hook")]),t._v(" which calls the strategy "),e("code",[t._v(".authenticate")]),t._v(" method with "),e("code",[t._v("params.authentication")]),t._v(" as the data")],1),t._v(" "),e("li",[t._v("Merge the return value of the strategy with "),e("code",[t._v("params")]),t._v(" (e.g. setting "),e("code",[t._v("params.user")]),t._v(")")])]),t._v(" "),e("h2",{attrs:{id:"authenticationservice"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authenticationservice"}},[t._v("#")]),t._v(" AuthenticationService")]),t._v(" "),e("h3",{attrs:{id:"constructor-app-configkey"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#constructor-app-configkey"}},[t._v("#")]),t._v(" constructor(app [, configKey])")]),t._v(" "),e("p",[e("code",[t._v("const authService = new AuthenticationService(app, configKey = 'authentication')")]),t._v(" initializes a new authentication service with the "),e("RouterLink",{attrs:{to:"/api/application.html"}},[t._v("Feathers application")]),t._v(" instance and a "),e("code",[t._v("configKey")]),t._v(" which is the name of the configuration property to use via "),e("RouterLink",{attrs:{to:"/api/application.html#get-name"}},[t._v("app.get()")]),t._v(" (default: "),e("code",[t._v("app.get('authentication')")]),t._v("). Upon initialization it will also update the configuration with the "),e("a",{attrs:{href:"#configuration"}},[t._v("default settings")]),t._v(".")],1),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Important:")]),t._v(" Unless otherwise "),e("a",{attrs:{href:"#customization"}},[t._v("customized")]),t._v(" "),e("code",[t._v("configKey")])])]),t._v(" "),e("h3",{attrs:{id:"authenticate-data-params-strategies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authenticate-data-params-strategies"}},[t._v("#")]),t._v(" authenticate(data, params, ...strategies)")]),t._v(" "),e("p",[e("code",[t._v("authService.authenticate(data, params, ...strategies) -> Promise")]),t._v(" is the main authentication method and authenticates "),e("code",[t._v("data")]),t._v(" and "),e("code",[t._v("params")]),t._v(" against a list of strategies in "),e("code",[t._v("strategies")]),t._v(".")]),t._v(" "),e("p",[e("code",[t._v("data")]),t._v(" "),e("em",[t._v("must")]),t._v(" always contain a "),e("code",[t._v("strategy")]),t._v(" property indicating the name of the strategy. If "),e("code",[t._v("data.strategy")]),t._v(" is not available or not allowed (included in the "),e("code",[t._v("strategies")]),t._v(" list) a "),e("code",[t._v("NotAuthenticated")]),t._v(" error will be thrown. Otherwise the result of "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html#authenticate-authentication-params"}},[t._v("strategy.authenticate()")]),t._v(" will be returned.")],1),t._v(" "),e("h3",{attrs:{id:"create-data-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-data-params"}},[t._v("#")]),t._v(" create(data, params)")]),t._v(" "),e("p",[e("code",[t._v("authService.create(data, params) -> Promise")]),t._v(" runs "),e("code",[t._v("authService.authenticate")]),t._v(" with "),e("code",[t._v("data")]),t._v(", "),e("code",[t._v("params")]),t._v(" and the list of "),e("code",[t._v("strategies")]),t._v(" from "),e("code",[t._v("authStrategies")]),t._v(" in the "),e("a",{attrs:{href:"#configuration"}},[t._v("configuration")]),t._v(". As with any other "),e("RouterLink",{attrs:{to:"/api/services.html"}},[t._v("Feathers service")]),t._v(", this method will be available to clients, e.g. running a "),e("code",[t._v("POST /authentication")]),t._v(".")],1),t._v(" "),e("p",[t._v("If successful it will create a JWT with the payload taken from "),e("a",{attrs:{href:"#getpayload-authresult-params"}},[t._v("authService.getPayload")]),t._v(" and the options from "),e("a",{attrs:{href:"#gettokenoptions-authresult-params"}},[t._v("authService.getTokenOptions")]),t._v(". "),e("code",[t._v("data")]),t._v(" "),e("em",[t._v("must")]),t._v(" always contain a valid and allowed "),e("code",[t._v("strategy")]),t._v(" name. Will emit the "),e("a",{attrs:{href:"#app-on-login"}},[e("code",[t._v("login")]),t._v(" event")]),t._v(".")]),t._v(" "),e("h3",{attrs:{id:"remove-id-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remove-id-params"}},[t._v("#")]),t._v(" remove(id, params)")]),t._v(" "),e("p",[e("code",[t._v("authService.remove(id, params) -> Promise")]),t._v(" should be called with "),e("code",[t._v("id")]),t._v(" set to "),e("code",[t._v("null")]),t._v(" or to the authenticated access token. Will verify "),e("code",[t._v("params.authentication")]),t._v(" and emit the "),e("a",{attrs:{href:"#app-on-logout"}},[e("code",[t._v("logout")]),t._v(" event")]),t._v(" if successful.")]),t._v(" "),e("h3",{attrs:{id:"configuration-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-2"}},[t._v("#")]),t._v(" configuration")]),t._v(" "),e("p",[e("code",[t._v("authService.configuration")]),t._v(" returns a copy of current value of "),e("code",[t._v("app.get(configKey)")]),t._v(" (default: "),e("code",[t._v("app.get('authentication')")]),t._v("). This is a deep copy of the configuration and is not intended to be modified. In order to change the configuration, "),e("RouterLink",{attrs:{to:"/api/application.html#set-name-value"}},[t._v("app.set(configKey)")]),t._v(" should be used:")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Update configuration with a new entity")]),t._v("\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  entity"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'some other entity name'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"register-name-strategy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#register-name-strategy"}},[t._v("#")]),t._v(" register(name, strategy)")]),t._v(" "),e("p",[e("code",[t._v("authService.register(name, strategy)")]),t._v(" registers an "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html"}},[t._v("authentication strategy")]),t._v(" under "),e("code",[t._v("name")]),t._v(" and calls the strategy methods "),e("code",[t._v("setName")]),t._v(", "),e("code",[t._v("setApplication")]),t._v(", "),e("code",[t._v("setAuthentication")]),t._v(" and "),e("code",[t._v("verifyConfiguration")]),t._v(" if they are implemented.")],1),t._v(" "),e("h3",{attrs:{id:"getstrategies-names"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getstrategies-names"}},[t._v("#")]),t._v(" getStrategies(...names)")]),t._v(" "),e("p",[e("code",[t._v("service.getStrategies(...names) -> AuthenticationStrategy[]")]),t._v(" returns the "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html"}},[t._v("authentication strategies")]),t._v(" that exist for a list of names. The returned array may include "),e("code",[t._v("undefined")]),t._v(" values if the strategy does not exist. Usually authentication strategies do not need to be used directly.")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" localStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStrategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'local'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"createaccesstoken-payload"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createaccesstoken-payload"}},[t._v("#")]),t._v(" createAccessToken(payload)")]),t._v(" "),e("p",[e("code",[t._v("authService.createAccessToken(payload, [options, secret]) -> Promise")]),t._v(" creates a new access token. By default it is a "),e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JWT"),e("OutboundLink")],1),t._v(" with "),e("code",[t._v("payload")]),t._v(", using "),e("a",{attrs:{href:"#configuration"}},[t._v("configuration.jwtOptions")]),t._v(" merged with "),e("code",[t._v("options")]),t._v(" (optional). It will either use "),e("code",[t._v("authService.configuration.secret")]),t._v(" or the optional "),e("code",[t._v("secret")]),t._v(" to sign the JWT. Throws an error if the access token can not be created.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAccessToken")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  permission"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[e("strong",[t._v("Note:")]),t._v(" Normally, it is not necessary to call this method directly. Calling "),e("a",{attrs:{href:"#create-data-params"}},[t._v("authService.create(data, params)")]),t._v(" using an authentication strategy will take care of creating the correct access token.")])]),t._v(" "),e("h3",{attrs:{id:"verifyaccesstoken-accesstoken"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#verifyaccesstoken-accesstoken"}},[t._v("#")]),t._v(" verifyAccessToken(accessToken)")]),t._v(" "),e("p",[e("code",[t._v("authService.verifyAccessToken(accessToken, [options, secret]) -> Promise")]),t._v(" verifies the access token. By default it will try to verify a JWT using "),e("code",[t._v("configuration.jwtOptions")]),t._v(" merged with "),e("code",[t._v("options")]),t._v(" (optional). Will either use "),e("code",[t._v("configuration.secret")]),t._v(" or the optional "),e("code",[t._v("secret")]),t._v(" to verify the JWT. Returns the encoded payload or throws an error.")]),t._v(" "),e("h3",{attrs:{id:"gettokenoptions-authresult-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gettokenoptions-authresult-params"}},[t._v("#")]),t._v(" getTokenOptions(authResult, params)")]),t._v(" "),e("p",[e("code",[t._v("authService.getTokenOptions(authResult, params) -> Promise")]),t._v(" returns the options for creating a new access token based on the return value from calling "),e("a",{attrs:{href:"#authenticate-data-params-strategies"}},[t._v("authService.authenticate()")]),t._v(". Called internally on "),e("a",{attrs:{href:"#create-data-params"}},[t._v("authService.create()")]),t._v(". It will try to set the JWT "),e("code",[t._v("subject")]),t._v(" to the entity (user) id if it is available which will then be used by the "),e("RouterLink",{attrs:{to:"/api/authentication/jwt.html"}},[t._v("JWT strategy")]),t._v(" to populate "),e("code",[t._v("params[entity]")]),t._v(" (usually "),e("code",[t._v("params.user")]),t._v(").")],1),t._v(" "),e("h3",{attrs:{id:"getpayload-authresult-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getpayload-authresult-params"}},[t._v("#")]),t._v(" getPayload(authResult, params)")]),t._v(" "),e("p",[e("code",[t._v("authService.getPayload(authResult, params) -> Promise")]),t._v(" returns the access token payload for an authentication result (the return value of "),e("a",{attrs:{href:"#create-data-params"}},[t._v("authService.create()")]),t._v(") and "),e("RouterLink",{attrs:{to:"/api/services.html#params"}},[t._v("service call parameters")]),t._v(". Called internally on "),e("a",{attrs:{href:"#create-data-params"}},[t._v(".create")]),t._v(". Returns either "),e("code",[t._v("params.payload")]),t._v(" or an empty object ("),e("code",[t._v("{}")]),t._v(").")],1),t._v(" "),e("h3",{attrs:{id:"parse-req-res-strategies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#parse-req-res-strategies"}},[t._v("#")]),t._v(" parse(req, res, ...strategies)")]),t._v(" "),e("p",[e("code",[t._v("authService.parse(req, res, ...strategies) -> Promise")]),t._v(" parses a "),e("a",{attrs:{href:"https://nodejs.org/api/http.html#http_class_http_incomingmessage",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeJS HTTP request"),e("OutboundLink")],1),t._v(" and "),e("a",{attrs:{href:"https://nodejs.org/api/http.html#http_class_http_serverresponse",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP response"),e("OutboundLink")],1),t._v(" for authentication information using "),e("code",[t._v("strategies")]),t._v(" calling "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html#parse-req-res"}},[t._v("each strategies "),e("code",[t._v(".parse()")]),t._v(" method")]),t._v(" if it is implemented. Will return the value of the first strategy that didn't return "),e("code",[t._v("null")]),t._v(". This does "),e("em",[t._v("not")]),t._v(" authenticate the request, it will only return authentication information that can be used by "),e("code",[t._v("authService.authenticate")]),t._v(" or "),e("code",[t._v("authService.create")]),t._v(".")],1),t._v(" "),e("h3",{attrs:{id:"setup-path-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-path-app"}},[t._v("#")]),t._v(" setup(path, app)")]),t._v(" "),e("p",[e("code",[t._v("authService.setup(path, app)")]),t._v(" verifies the "),e("a",{attrs:{href:"#configuration"}},[t._v("configuration")]),t._v(" and makes sure that")]),t._v(" "),e("ul",[e("li",[t._v("A "),e("code",[t._v("secret")]),t._v(" has been set")]),t._v(" "),e("li",[t._v("If "),e("code",[t._v("entity")]),t._v(" is not "),e("code",[t._v("null")]),t._v(", check if the entity service is available and make sure that either the "),e("code",[t._v("entityId")]),t._v(" configuration or the "),e("code",[t._v("entityService.id")]),t._v(" property is set.")]),t._v(" "),e("li",[t._v("Register internal hooks to send events and keep real-time connections up to date. All custom hooks should be registered at this time.")])]),t._v(" "),e("h2",{attrs:{id:"app-get-defaultauthentication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#app-get-defaultauthentication"}},[t._v("#")]),t._v(" app.get('defaultAuthentication')")]),t._v(" "),e("p",[t._v("After registering an authentication service, it will set the "),e("code",[t._v("defaultAuthentication")]),t._v(" property on the application to its configuration name ("),e("code",[t._v("configKey")]),t._v(" set in the constructor) if it does not exist. "),e("code",[t._v("app.get('defaultAuthentication')")]),t._v(" will be used by other parts of Feathers authentication to access the authentication service if it is not otherwise specified. Usually this will be "),e("code",[t._v("'authentication'")]),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"customization"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#customization"}},[t._v("#")]),t._v(" Customization")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("AuthenticationService")]),t._v(" can be customized like any other ES6 class:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AuthenticationService "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyAuthService")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationService")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPayload")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("authResult"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Call original `getPayload` first")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" payload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPayload")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("authResult"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" user "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" authResult"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyAuthService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Things to be aware of when extending the authentication service:")]),t._v(" "),e("ul",[e("li",[t._v("When implementing your own "),e("code",[t._v("constructor")]),t._v(", always call "),e("code",[t._v("super(app, configKey)")])]),t._v(" "),e("li",[t._v("When overriding a method, calling "),e("code",[t._v("super.method")]),t._v(" and working with its return value is recommended unless you are certain your custom method behaves exactly the same way, otherwise things may no longer work as expected.")]),t._v(" "),e("li",[t._v("When extending "),e("code",[t._v("setup")]),t._v(", "),e("code",[t._v("super.setup(path, app)")]),t._v(" should always be called, otherwise events and real-time connection authentication will no longer work.")])]),t._v(" "),e("h2",{attrs:{id:"events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#events"}},[t._v("#")]),t._v(" Events")]),t._v(" "),e("p",[t._v("For both, "),e("code",[t._v("login")]),t._v(" and "),e("code",[t._v("logout")]),t._v(" the event data is "),e("code",[t._v("(authResult, params, context) => {}")]),t._v(" as follows:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("authResult")]),t._v(" is the return value of the "),e("code",[t._v("authService.create")]),t._v(" or "),e("code",[t._v("authService.remove")]),t._v(" call. It usually contains the user and access token.")]),t._v(" "),e("li",[e("code",[t._v("params")]),t._v(" is the service call parameters")]),t._v(" "),e("li",[e("code",[t._v("context")]),t._v(" is the service methods "),e("RouterLink",{attrs:{to:"/api/hooks.html#hook-context"}},[t._v("hook context")])],1)]),t._v(" "),e("h3",{attrs:{id:"app-on-login"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#app-on-login"}},[t._v("#")]),t._v(" app.on('login')")]),t._v(" "),e("p",[e("code",[t._v("app.on('login', (authResult, params, context) => {})")]),t._v(" will be sent after a user logs in. This means, after any successful external call to "),e("a",{attrs:{href:"#create-data-params"}},[t._v("authService.create")]),t._v(".")]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Important:")]),t._v(" The "),e("code",[t._v("login")]),t._v(" event is also sent for e.g. reconnections of websockets and may not always have a corresponding "),e("code",[t._v("logout")]),t._v(" event. Use the "),e("RouterLink",{attrs:{to:"/api/channels.html#app-on-disconnect"}},[e("code",[t._v("disconnect")]),t._v(" event")]),t._v(" for handling disconnection.")],1)]),t._v(" "),e("h3",{attrs:{id:"app-on-logout"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#app-on-logout"}},[t._v("#")]),t._v(" app.on('logout')")]),t._v(" "),e("p",[e("code",[t._v("app.on('logout', (authResult, params, context) => {})")]),t._v(" will be sent after a user explicitly logs out. This means after any successful external call to "),e("a",{attrs:{href:"#remove-id-params"}},[t._v("authService.remove")]),t._v(".")])],1)}),[],!1,null,null,null);a.default=n.exports}}]);