(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{412:function(t,a,e){"use strict";e.r(a);var s=e(43),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"oauth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauth"}},[t._v("#")]),t._v(" OAuth")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.npmjs.com/package/@feathersjs/authentication-oauth",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/npm/v/@feathersjs/authentication-oauth.svg?style=flat-square",alt:"npm version"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://github.com/feathersjs/feathers/blob/crow/packages/authentication-oauth/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/changelog-.md-blue.svg?style=flat-square",alt:"Changelog"}}),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("npm install @feathersjs/authentication-oauth --save\n")])])]),e("p",[e("code",[t._v("@feathersjs/authentication-oauth")]),t._v(" allows to authenticate with over 180 OAuth providers (Google, Facebook, GitHub etc.) using "),e("a",{attrs:{href:"https://github.com/simov/grant",target:"_blank",rel:"noopener noreferrer"}},[t._v("grant"),e("OutboundLink")],1),t._v(", an OAuth middleware module for NodeJS.")]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("p",[t._v("The following settings are available:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("redirect")]),t._v(": The URL of the frontend to redirect to with the access token (or error message). The "),e("RouterLink",{attrs:{to:"/api/authentication/client.html"}},[t._v("authentication client")]),t._v(" handles those redirects automatically. If not set, the authentication result will be sent as JSON instead.")],1),t._v(" "),e("li",[e("code",[t._v("defaults")]),t._v(": Default "),e("a",{attrs:{href:"https://github.com/simov/grant#configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grant configuration"),e("OutboundLink")],1),t._v(" used for all strategies. The following default options are set automatically:\n"),e("ul",[e("li",[e("code",[t._v("path")]),t._v(" (default: "),e("code",[t._v("'/oauth'")]),t._v(") - The OAuth base path")])])]),t._v(" "),e("li",[e("code",[t._v("<strategy-name>")]),t._v(" (e.g. "),e("code",[t._v("twitter")]),t._v("): The "),e("a",{attrs:{href:"https://github.com/simov/grant#configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grant configuration"),e("OutboundLink")],1),t._v(" used for a specific strategy.")]),t._v(" "),e("li",[t._v("For both "),e("code",[t._v("defaults")]),t._v(" and specific strategies, the following options are set automatically:\n"),e("ul",[e("li",[e("code",[t._v("host")]),t._v(": Set to "),e("code",[t._v("host")]),t._v(" from the configuration")]),t._v(" "),e("li",[e("code",[t._v("protocol")]),t._v(": "),e("code",[t._v("'http'")]),t._v(" for development, "),e("code",[t._v("'https'")]),t._v(" for production (when "),e("code",[t._v("NODE_ENV=production")]),t._v(")")]),t._v(" "),e("li",[e("code",[t._v("transport")]),t._v(": Set to "),e("code",[t._v("'session'")]),t._v(" (see "),e("a",{attrs:{href:"https://github.com/simov/grant#response-data-transport",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grant response data"),e("OutboundLink")],1),t._v(")")]),t._v(" "),e("li",[e("code",[t._v("callback")]),t._v(": Set to "),e("code",[t._v("'<defaults.path>/<name>/authenticate'")]),t._v(". This should not be changed.")])])])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Pro tip:")]),t._v(" Removing the "),e("code",[t._v("redirect")]),t._v(" setting is a good way to troubleshoot OAuth authentication errors.")])]),t._v(" "),e("p",[t._v("Standard OAuth authentication can be configured with those options in "),e("code",[t._v("config/default.json")]),t._v(" like this:")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"authentication"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"oauth"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"redirect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/frontend"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"google"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"secret"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"custom_params"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"access_type"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"offline"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"twitter"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"secret"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[e("strong",[t._v("Note:")]),t._v(" All OAuth strategies will by default always look for configuration under "),e("code",[t._v("authentication.oauth.<name>")]),t._v(". If "),e("code",[t._v("authentication.oauth")]),t._v(" is not set in the configuration, OAuth authentication will be disabled.")])]),t._v(" "),e("p",[t._v("Here is a "),e("a",{attrs:{href:"https://github.com/simov/grant#all-available-options",target:"_blank",rel:"noopener noreferrer"}},[t._v("list of all Grant configuration options"),e("OutboundLink")],1),t._v(" that are available:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Key")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Location")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("request_url")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant/blob/master/config/oauth.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("oauth.json"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth1/step1")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("authorize_url")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant/blob/master/config/oauth.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("oauth.json"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth1/step2 or OAuth2/step1")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("access_url")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant/blob/master/config/oauth.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("oauth.json"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth1/step3 or OAuth2/step2")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("oauth")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant/blob/master/config/oauth.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("oauth.json"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth version number")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("scope_delimiter")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant/blob/master/config/oauth.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("oauth.json"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("string delimiter used for concatenating multiple scopes")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("protocol, host, path")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("defaults")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("used to generate "),e("code",[t._v("redirect_uri")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("transport")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("defaults")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"#response-data-transport"}},[t._v("transport")]),t._v(" to use to deliver the response data in your final "),e("code",[t._v("callback")]),t._v(" route")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("state")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("defaults")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("toggle random "),e("code",[t._v("state")]),t._v(" string generation for OAuth2")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("key")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth app key, reserved aliases: "),e("code",[t._v("consumer_key")]),t._v(" and "),e("code",[t._v("client_id")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("secret")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth app secret, reserved aliases: "),e("code",[t._v("consumer_secret")]),t._v(" and "),e("code",[t._v("client_secret")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("scope")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("list of scopes to request")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("custom_params")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("custom authorization "),e("a",{attrs:{href:"#custom-parameters"}},[t._v("parameters")]),t._v(" and their values")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("subdomain")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("string to be "),e("a",{attrs:{href:"#subdomain-urls"}},[t._v("embedded")]),t._v(" in "),e("code",[t._v("request_url")]),t._v(", "),e("code",[t._v("authorize_url")]),t._v(" and "),e("code",[t._v("access_url")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("nonce")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("toggle random "),e("code",[t._v("nonce")]),t._v(" string generation for "),e("a",{attrs:{href:"#openid-connect"}},[t._v("OpenID Connect")]),t._v(" providers")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("callback")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("final callback route on your server to receive the "),e("a",{attrs:{href:"#response-data"}},[t._v("response data")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("dynamic")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("allow "),e("a",{attrs:{href:"#dynamic-override"}},[t._v("dynamic override")]),t._v(" of configuration")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("overrides")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"#static-overrides"}},[t._v("static overrides")]),t._v(" for a provider")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("response")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"#limit-response-data"}},[t._v("limit")]),t._v(" the response data")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("token_endpoint_auth_method")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("code",[t._v("[provider]")])]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("authentication method for the "),e("a",{attrs:{href:"#token-endpoint-auth-method"}},[t._v("token endpoint")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("name")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("generated")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("provider's "),e("a",{attrs:{href:"#grant"}},[t._v("name")]),t._v(", used to generate "),e("code",[t._v("redirect_uri")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("profile_url")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/simov/grant-profile",target:"_blank",rel:"noopener noreferrer"}},[t._v("grant-profile"),e("OutboundLink")],1)]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("The URL to retrieve the user profile from")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("[provider]")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("generated")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("provider's "),e("a",{attrs:{href:"#grant"}},[t._v("name")]),t._v(" as key")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("redirect_uri")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("generated")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth app "),e("a",{attrs:{href:"#redirect-uri"}},[t._v("redirect URI")]),t._v(", generated using "),e("code",[t._v("protocol")]),t._v(", "),e("code",[t._v("host")]),t._v(", "),e("code",[t._v("path")]),t._v(" and "),e("code",[t._v("name")])])])])]),t._v(" "),e("h2",{attrs:{id:"usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),e("h3",{attrs:{id:"cookbook-guides"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookbook-guides"}},[t._v("#")]),t._v(" Cookbook guides")]),t._v(" "),e("p",[t._v("For specific OAuth provider setup see the following "),e("RouterLink",{attrs:{to:"/cookbook/"}},[t._v("cookbook")]),t._v(" guides:")],1),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/cookbook/authentication/auth0.html"}},[t._v("Auth0")])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/cookbook/authentication/facebook.html"}},[t._v("Facebook")])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/cookbook/authentication/google.html"}},[t._v("Google")])],1)]),t._v(" "),e("h3",{attrs:{id:"flow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flow"}},[t._v("#")]),t._v(" Flow")]),t._v(" "),e("p",[t._v("There are two ways to initiate OAuth authentication:")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Through the browser (most common)")]),t._v(" "),e("ul",[e("li",[t._v("User clicks on link to OAuth URL ("),e("code",[t._v("oauth/<provider>")]),t._v(")")]),t._v(" "),e("li",[t._v("Gets redirected to provider and authorizes the application")]),t._v(" "),e("li",[t._v("Callback to the "),e("a",{attrs:{href:"#oauthstrategy"}},[t._v("OauthStrategy")]),t._v(" which\n"),e("ul",[e("li",[t._v("Gets the users profile")]),t._v(" "),e("li",[t._v("Finds or creates the user (entity) for that profile")])])]),t._v(" "),e("li",[t._v("The "),e("RouterLink",{attrs:{to:"/api/authentication/service.html"}},[t._v("AuthenticationService")]),t._v(" creates an access token for that entity")],1),t._v(" "),e("li",[t._v("Redirect to the "),e("code",[t._v("redirect")]),t._v(" URL including the generated access token")]),t._v(" "),e("li",[t._v("The frontend (e.g. "),e("RouterLink",{attrs:{to:"/api/authentication/client.html"}},[t._v("authentication client")]),t._v(") uses the returned access token to authenticate")],1)])]),t._v(" "),e("li",[e("p",[t._v("With an existing access token, e.g. obtained through the Facebook mobile SDK")]),t._v(" "),e("ul",[e("li",[t._v("Authenticate normally with "),e("code",[t._v("{ strategy: '<name>', access_token: 'oauth access token' }")]),t._v(".")]),t._v(" "),e("li",[t._v("Calls the "),e("a",{attrs:{href:"#oauthstrategy"}},[t._v("OauthStrategy")]),t._v(" which\n"),e("ul",[e("li",[t._v("Gets the users profile")]),t._v(" "),e("li",[t._v("Finds or creates the entity for that profile")])])]),t._v(" "),e("li",[t._v("Returns the authentication result")])])])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Note:")]),t._v(" If you are attempting to authenticate using an obtained access token, ensure that you have added the strategy (e.g. 'facebook') to your "),e("RouterLink",{attrs:{to:"/api/authentication/service.html#configuration"}},[t._v("authStrategies")]),t._v(".")],1)]),t._v(" "),e("h3",{attrs:{id:"oauth-urls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauth-urls"}},[t._v("#")]),t._v(" OAuth URLs")]),t._v(" "),e("p",[t._v("There are several URLs and redirects that are important for OAuth authentication:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("http(s)://<host>/oauth/<provider>")]),t._v(": The main URL to initiate the OAuth flow. Link to this from the browser.")]),t._v(" "),e("li",[e("code",[t._v("http(s)://<host>/oauth/<provider>/callback")]),t._v(": The callback path that should be set in the OAuth application settings")]),t._v(" "),e("li",[e("code",[t._v("http(s)://<host>/oauth/<provider>/authenticate")]),t._v(": The internal redirect")])]),t._v(" "),e("p",[t._v("In the browser any OAuth flow can be initiated with the following link:")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/oauth/github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Login with GitHub"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),e("h3",{attrs:{id:"account-linking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#account-linking"}},[t._v("#")]),t._v(" Account linking")]),t._v(" "),e("p",[t._v("To "),e("em",[t._v("link an existing user")]),t._v(" the current access token can be added to the OAuth flow query using the "),e("code",[t._v("feathers_token")]),t._v(" query parameter:")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/oauth/github?feathers_token=<your access token>"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  Login with GitHub\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),e("p",[t._v("This will use the user (entity) of that access token to link the OAuth account to. Using the "),e("RouterLink",{attrs:{to:"/api/authentication/client.html"}},[t._v("authentication client")]),t._v(" you can get the current access token via "),e("code",[t._v("app.get('authentication')")]),t._v(":")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" accessToken "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"redirects"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redirects"}},[t._v("#")]),t._v(" Redirects")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("redirect")]),t._v(" configuration option is used to redirect back to the frontend application after OAuth authentication was successful and an access token for the user has been created by the "),e("RouterLink",{attrs:{to:"/api/authentication/service.html"}},[t._v("authentication service")]),t._v(" or if authentication failed. It works cross domain and by default includes the access token or error message in the window location hash. The following configuration")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authentication"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"oauth"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redirect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://app.mydomain.com/"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Will redirect to "),e("code",[t._v("https://app.mydomain.com/#access_token=<user jwt>")]),t._v(" or "),e("code",[t._v("https://app.mydomain.com/#error=<some error message>")]),t._v(". Redirects can be customized with the "),e("a",{attrs:{href:"#getredirect-data"}},[t._v("getRedirect()")]),t._v(" method of the OAuth strategy. The "),e("RouterLink",{attrs:{to:"/api/authentication/client.html"}},[t._v("authentication client")]),t._v(" handles the default redirects automatically already.")],1),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("Note:")]),t._v(" The redirect is using a hash instead of a query string by default because it is not logged server side and can be easily read on the client. You can force query based redirect by adding a "),e("code",[t._v("?")]),t._v(" to the end of the "),e("code",[t._v("redirect")]),t._v(" option.")])]),t._v(" "),e("p",[t._v("If the "),e("code",[t._v("redirect")]),t._v(" option is not set, the authentication result data will be sent as JSON instead.")]),t._v(" "),e("p",[t._v("Dynamic redirects to the same URL are possible by setting the "),e("code",[t._v("redirect")]),t._v(" query parameter in the OAuth flow. For example, the following OAuth link:")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/oauth/github?redirect=dashboard"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  Login with GitHub\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),e("p",[t._v("With the above configuration will redirect to "),e("code",[t._v("https://app.mydomain.com/dashboard")]),t._v(" after the OAuth flow.")]),t._v(" "),e("h2",{attrs:{id:"setup-express"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-express"}},[t._v("#")]),t._v(" Setup (Express)")]),t._v(" "),e("p",[e("code",[t._v("expressOauth")]),t._v(" (for setup see the "),e("RouterLink",{attrs:{to:"/api/authentication/service.html"}},[t._v("AuthenticationService")]),t._v(") sets up OAuth authentication on a "),e("RouterLink",{attrs:{to:"/api/express.html"}},[t._v("Feathers Express")]),t._v(" application and can take the following options:")],1),t._v(" "),e("ul",[e("li",[e("code",[t._v("authService")]),t._v(": The name of the authentication service")]),t._v(" "),e("li",[e("code",[t._v("linkStrategy")]),t._v(" (default: "),e("code",[t._v("'jwt'")]),t._v("): The name of the strategy to use for account linking")]),t._v(" "),e("li",[e("code",[t._v("expressSession")]),t._v(" (default: "),e("code",[t._v("require('express-session')()")]),t._v("): The "),e("a",{attrs:{href:"https://github.com/expressjs/session",target:"_blank",rel:"noopener noreferrer"}},[t._v("Express session"),e("OutboundLink")],1),t._v(" middleware to use. Uses in-memory sessions by default but may need to be customized to a persistent storage when using multiple instances of the application. Other sessions stores can be used by setting the "),e("code",[t._v("expressSession")]),t._v(" option using a different memory store, e.g. "),e("a",{attrs:{href:"https://github.com/tj/connect-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("connect-redis"),e("OutboundLink")],1),t._v(" in the authentication configuration:")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" redis "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" session "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express-session'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" expressOauth "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-oauth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" RedisStore "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'connect-redis'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("session"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" redisClient "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createClient")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("expressOauth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  expressSession"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("session")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    store"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisStore")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" client"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" redisClient "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    secret"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'keyboard cat'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    resave"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[e("strong",[t._v("Important:")]),t._v("  If not customized, Express OAuth uses the in-memory Express session store which will show a "),e("code",[t._v("connect.session() MemoryStore is not designed for a production environment, as it will leak memory, and will not scale past a single process.")]),t._v(" warning in production.")])]),t._v(" "),e("h2",{attrs:{id:"oauthstrategy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauthstrategy"}},[t._v("#")]),t._v(" OAuthStrategy")]),t._v(" "),e("h3",{attrs:{id:"entityid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#entityid"}},[t._v("#")]),t._v(" entityId")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.entityId -> string")]),t._v(" returns the name of the id property of the entity.")]),t._v(" "),e("h3",{attrs:{id:"getentityquery-profile-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getentityquery-profile-params"}},[t._v("#")]),t._v(" getEntityQuery(profile, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.getEntityQuery(profile, params) -> Promise")]),t._v(" returns the entity lookup query to find the entity for a profile. By default returns")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Id")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sub "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"getentitydata-profile-entity-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getentitydata-profile-entity-params"}},[t._v("#")]),t._v(" getEntityData(profile, entity, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.getEntityData(profile, existing, params) -> Promise")]),t._v("  returns the data to either create a new or update an existing entity. "),e("code",[t._v("entity")]),t._v(" is either the existing entity or "),e("code",[t._v("null")]),t._v(" when creating a new entity.")]),t._v(" "),e("h3",{attrs:{id:"getprofile-data-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getprofile-data-params"}},[t._v("#")]),t._v(" getProfile(data, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.getProfile(data, params) -> Promise")]),t._v(" returns the user profile information from the OAuth provider that was used for the login. "),e("code",[t._v("data")]),t._v(" is the OAuth callback information which normally contains e.g. the OAuth access token.")]),t._v(" "),e("h3",{attrs:{id:"getredirect-data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getredirect-data"}},[t._v("#")]),t._v(" getRedirect (data)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.getRedirect(data) -> Promise")]),t._v(" returns the URL to redirect to after a successful OAuth login and entity lookup or creation. By default it redirects to "),e("code",[t._v("authentication.oauth.redirect")]),t._v(" from the configuration with "),e("code",[t._v("#access_token=<access token for entity>")]),t._v(" added to the end of the URL. The "),e("code",[t._v("access_token")]),t._v(" hash is e.g. used by the "),e("RouterLink",{attrs:{to:"/api/authentication/client.html"}},[t._v("authentication client")]),t._v(" to log the user in after a successful OAuth login. The default redirects do work cross domain.")],1),t._v(" "),e("h3",{attrs:{id:"getcurrententity-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getcurrententity-params"}},[t._v("#")]),t._v(" getCurrentEntity(params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.getCurrentEntity(params) -> Promise")]),t._v(" returns the currently linked entity for the given "),e("code",[t._v("params")]),t._v(". It will either use the entity authenticated by "),e("code",[t._v("params.authentication")]),t._v(" or return "),e("code",[t._v("null")]),t._v(".")]),t._v(" "),e("h3",{attrs:{id:"findentity-profile-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#findentity-profile-params"}},[t._v("#")]),t._v(" findEntity(profile, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.findEntity(profile, params) -> Promise")]),t._v(" finds an entity for a given OAuth profile. Uses "),e("code",[t._v("{ [${this.name}Id]: profile.id }")]),t._v(" by default.")]),t._v(" "),e("h3",{attrs:{id:"createentity-profile-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createentity-profile-params"}},[t._v("#")]),t._v(" createEntity(profile, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.createEntity(profile, params) -> Promise")]),t._v(" creates a new entity for the given OAuth profile. Uses "),e("code",[t._v("{ [${this.name}Id]: profile.id }")]),t._v(" by default.")]),t._v(" "),e("h3",{attrs:{id:"updateentity-entity-profile-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#updateentity-entity-profile-params"}},[t._v("#")]),t._v(" updateEntity(entity, profile, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.updateEntity(entity, profile, params) -> Promise")]),t._v(" updates an existing entity with the given profile. Uses "),e("code",[t._v("{ [${this.name}Id]: profile.id }")]),t._v(" by default.")]),t._v(" "),e("h3",{attrs:{id:"authenticate-authentication-params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authenticate-authentication-params"}},[t._v("#")]),t._v(" authenticate(authentication, params)")]),t._v(" "),e("p",[e("code",[t._v("oauthStrategy.authenticate(authentication, params)")]),t._v(" is the main endpoint implemented by any "),e("RouterLink",{attrs:{to:"/api/authentication/strategy.html"}},[t._v("authentication strategy")]),t._v(". It is usually called for authentication requests for this strategy by the "),e("RouterLink",{attrs:{to:"/api/authentication/service.html"}},[t._v("AuthenticationService")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"customization"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#customization"}},[t._v("#")]),t._v(" Customization")]),t._v(" "),e("p",[t._v("Normally, any OAuth provider set up in the "),e("a",{attrs:{href:"#configuration"}},[t._v("configuration")]),t._v(" will be initialized with the default "),e("a",{attrs:{href:"#oauthstrategy"}},[t._v("OAuthStrategy")]),t._v(". The flow for a specific provider can be customized by extending "),e("code",[t._v("OAuthStrategy")]),t._v(" class and registering it under that name on the "),e("RouterLink",{attrs:{to:"/api/authentication/service.html"}},[t._v("AuthenticationService")]),t._v(":")],1),t._v(" "),e("tabs",{attrs:{options:{useUrlFragment:!1}}},[e("tab",{attrs:{name:"JavaScript"}},[e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AuthenticationService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" JWTStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" OAuthStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-oauth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyGithubStrategy")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OAuthStrategy")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntityData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("profile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Include the `email` from the GitHub profile when creating")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or updating a user that logged in with GitHub")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseData "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntityData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("baseData"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      email"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" authService "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'github'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyGithubStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("tab",{attrs:{name:"TypeScript"}},[e("div",{staticClass:"language-typescript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-typescript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Application "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/feathers'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AuthenticationService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" JWTStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" OAuthStrategy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@feathersjs/authentication-oauth'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyGithubStrategy")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OAuthStrategy")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntityData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("profile"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Include the `email` from the GitHub profile when creating")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or updating a user that logged in with GitHub")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseData "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntityData")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("baseData"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      email"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" profile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Application"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" authService "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'github'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyGithubStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" authService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])],1)],1)}),[],!1,null,null,null);a.default=n.exports}}]);